<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4 text-white fw-bold text-end p-3"
          style="background-color: var(--primary-color); border-radius: 8px;">
        <i class="fas fa-shopping-cart me-3"></i>
        طلبات الصيدليات
      </h2>

      <!-- Error Alert -->
      <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ error }}
        <button type="button" class="btn-close" (click)="error = null"></button>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="loading" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">جاري تحميل الطلبات...</p>
      </div>

      <!-- Orders content -->
      <div *ngIf="!loading">
        <!-- <div class="d-flex justify-content-between align-items-center mb-3" dir ="rtl">
          <h4>طلبات الصيدليات</h4>
        </div> -->
        <div class="d-flex justify-content-between align-items-center mb-3" dir ="rtl">
            <button class="btn btn-primary" (click)="fetchOrders()" >
              <i class="fas fa-sync me-2"></i>
              تحديث الطلبات
            </button>
        </div>

        <!-- Debug Info -->
        <div class="alert alert-info mb-3" *ngIf="orders.length > 0" dir = "rtl">
          <i class="fas fa-info-circle me-2"></i>
          تم العثور على {{ orders.length }} طلب من الصيدليات
        </div>

        <!-- Debug Info for empty orders -->
        <!-- <div class="alert alert-warning mb-3" *ngIf="!loading && orders.length === 0" dir="rtl">
          <i class="fas fa-exclamation-triangle me-2"></i>
          لا توجد طلبات متاحة. تأكد من الاتصال بالخادم.
        </div> -->

        <!-- Orders Table -->
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th>رقم الطلب</th>
                <th>اسم الصيدلية</th>
                <th>تاريخ الطلب</th>
                <th>وقت الطلب</th>
                <th>الكمية الإجمالية</th>
                <th>المبلغ الإجمالي</th>
                <th>حالة الطلب</th>
                <th>الإجراءات</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let order of paginatedOrders">
                <td>{{ order.orderId }}</td>
                <td>{{ order.pharmacyName }}</td>
                <td>{{ order.orderDate | date:'yyyy/MM/dd' }}</td>
                <td>{{ order.orderDate | date:'hh:mm a' }}</td>
                <td>{{ order.quantity }}</td>
                <td>{{ order.totalPrice }}</td>

                <!-- Status Column -->
                <td>
                  <span class="badge" 
                        [class.bg-primary]="order.status === 'Ordered'"
                        [class.bg-warning]="order.status === 'Preparing'"
                        [class.bg-info]="order.status === 'Delivering'"
                        [class.bg-success]="order.status === 'Delivered'"
                        [class.bg-danger]="order.status === 'Cancelled'"
                        [class.bg-secondary]="order.status === 'Returned'">
                    {{ getOrderStatusText(order.status) }}
                  </span>
                </td>

                <!-- Actions Column -->
                <td>
                  <div class="btn-group" role="group">
                    <a class="btn btn-sm btn-info-dark text-white"
                       [routerLink]="['/dashboard/order-details', order.orderId]"
                       title="عرض التفاصيل">
                      <i class="fas fa-eye me-1"></i>
                      التفاصيل
                    </a>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div *ngIf="orders.length === 0" class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i>
          لا توجد طلبات حالياً.
        </div>

        <!-- Pagination Controls -->
        <nav *ngIf="totalPages > 1" aria-label="Page navigation" class="mt-3">
          <ul class="pagination justify-content-center">
            <!-- Previous -->
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="previousPage()">السابق</button>
            </li>

            <!-- Page Numbers -->
            <li class="page-item" 
                *ngFor="let page of [].constructor(totalPages); let i = index"
                [class.active]="currentPage === (i + 1)">
              <button class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</button>
            </li>

            <!-- Next -->
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button class="page-link" (click)="nextPage()">التالي</button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
